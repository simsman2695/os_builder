From 450a7b9d3a9b87c7fe73cbfe76b38605f697ebbf Mon Sep 17 00:00:00 2001
From: Daniel Almeida <daniel.almeida@collabora.com>
Date: Fri, 17 Oct 2025 06:38:26 -0300
Subject: [PATCH 114/161] tyr: fix broken array length in ioctls

---
 drivers/gpu/drm/tyr/file.rs | 13 ++++++++-----
 1 file changed, 8 insertions(+), 5 deletions(-)

diff --git a/drivers/gpu/drm/tyr/file.rs b/drivers/gpu/drm/tyr/file.rs
index 1f58f5aecc..06187af752 100644
--- a/drivers/gpu/drm/tyr/file.rs
+++ b/drivers/gpu/drm/tyr/file.rs
@@ -142,8 +142,11 @@ pub(crate) fn vm_bind(
         let stride = vmbind.ops.stride as usize;
         let count = vmbind.ops.count as usize;
 
-        let mut reader =
-            UserSlice::new(UserPtr::from_addr(vmbind.ops.array as usize), stride).reader();
+        let mut reader = UserSlice::new(
+            UserPtr::from_addr(vmbind.ops.array as usize),
+            stride * count,
+        )
+        .reader();
         let iomem = tdev.iomem.clone();
 
         for i in 0..count {
@@ -266,7 +269,7 @@ pub(crate) fn group_create(
 
         let mut reader = UserSlice::new(
             UserPtr::from_addr(groupcreate.queues.array as usize),
-            groupcreate.queues.stride as usize,
+            groupcreate.queues.stride as usize * groupcreate.queues.count as usize,
         )
         .reader();
 
@@ -314,7 +317,7 @@ pub(crate) fn group_submit(
 
         let mut reader = UserSlice::new(
             UserPtr::from_addr(groupsubmit.queue_submits.array as usize),
-            groupsubmit.queue_submits.stride as usize,
+            groupsubmit.queue_submits.stride as usize * groupsubmit.queue_submits.count as usize,
         )
         .reader();
 
@@ -326,7 +329,7 @@ pub(crate) fn group_submit(
 
             let mut sync_reader = UserSlice::new(
                 UserPtr::from_addr(queue.syncs.array as usize),
-                queue.syncs.stride as usize,
+                queue.syncs.stride as usize * queue.syncs.count as usize,
             )
             .reader();
 
-- 
2.51.0

