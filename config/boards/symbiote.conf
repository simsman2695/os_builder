# symbiote.conf — board config for Symbiote (Rock 5B with vendor U-Boot in SPI NOR)
#
# MFG boards have Rockchip vendor U-Boot 2017.09 in SPI NOR that cannot be
# reflashed. The vendor U-Boot expects an EFI System Partition in the GPT to
# trigger distro boot. We add an empty FAT16 ESP to satisfy this requirement.
# No bootloader is written to the image — it's all in SPI NOR.

# ── SoC / board identity ────────────────────────────────────────────────────
BOARD_CHIP="rk3588"
BOARD_NAME="Symbiote"

# ── kernel profile ──────────────────────────────────────────────────────────
# Select kernel profile: "6.1" (default, Mali blob + RKNPU2) or "6.18" (Panthor + Rocket)
# Override with: KERNEL_PROFILE=6.18 ./build.sh symbiote
KERNEL_PROFILE="${KERNEL_PROFILE:-6.1}"

# ── kernel (defaults, overridden by profile) ────────────────────────────────
KERNEL_VERSION="auto"
KERNEL_DEFCONFIG="rockchip_linux_defconfig"
KERNEL_CONFIG_FRAGMENTS=("arch/arm64/configs/rk3588_linux.config")

# DTS files to fetch from Radxa's kernel fork (empty = kernel has them built-in)
DTS_REPO="https://github.com/radxa/kernel"
DTS_BRANCH="linux-6.1-stan-rkr4.1"
DTS_FILES=()
DTB_TARGETS=(
    "rk3588-rock-5b.dtb"
)

# Device tree overlays applied at build time (enables GMAC1 Ethernet)
DT_OVERLAYS=(
    "config/dt-overlays/rk3588-symbiote-gmac1.dts"
)

# ── U-Boot / bootloader layout ──────────────────────────────────────────────
# Vendor U-Boot lives in SPI NOR — do NOT write bootloader to the image
WRITE_RAW_BOOTLOADER=false

# Keep these for reference / compatibility but they are unused with WRITE_RAW_BOOTLOADER=false
UBOOT_IDBLOADER_OFFSET=64
UBOOT_ITB_OFFSET=16384
UBOOT_IDBLOADER_URL=""
UBOOT_ITB_URL=""
UBOOT_PREBUILT_IDBLOADER_URL="https://github.com/inindev/rock-5b/releases/download/v12-6.7-rc7/idbloader.img"
UBOOT_PREBUILT_ITB_URL="https://github.com/inindev/rock-5b/releases/download/v12-6.7-rc7/u-boot.itb"

# U-Boot build from source (not used for symbiote, but kept for build system compatibility)
UBOOT_REPO="https://github.com/radxa/u-boot.git"
UBOOT_BRANCH="stable-5.10-rock5"
UBOOT_DEFCONFIG="rock-5b-rk3588_defconfig"

# rkbin (BL31 + DDR blob)
RKBIN_REPO="https://github.com/rockchip-linux/rkbin.git"
RKBIN_BL31="bin/rk35/rk3588_bl31_v1.45.elf"
RKBIN_TPL="bin/rk35/rk3588_ddr_lp4_2112MHz_lp5_2400MHz_v1.16.bin"

# ── EFI boot partition (required for vendor U-Boot distro boot) ─────────────
# The vendor U-Boot scans GPT for an EFI System Partition. Without it, it fails
# with "Failed to get kernel dtb" and never reaches extlinux scanning.
# The ESP can be empty — its mere presence triggers distro boot.
BOOT_PART_ENABLE=true
BOOT_PART_OFFSET_SECTOR=49152    # 24 MiB (matches MFG image layout)
BOOT_PART_SIZE_SECTORS=81920     # 40 MiB (matches MFG image layout)
BOOT_PART_FSTYPE="vfat"          # FAT16

# ── image layout ─────────────────────────────────────────────────────────────
IMAGE_SIZE_MB=auto
ROOTFS_OFFSET_MB=64              # rootfs at sector 131072 (after ESP)
ROOTFS_FSTYPE="ext4"
ROOTFS_LABEL="rootfs"

# ── serial console ───────────────────────────────────────────────────────────
SERIAL_TTY="ttyFIQ0"
SERIAL_BAUD="1500000"

# ── GPU / NPU userspace ────────────────────────────────────────────────────
# Mali Valhall G610 userspace blob (GBM variant, headless)
LIBMALI_URL="https://github.com/JeffyCN/mirrors/raw/libmali/lib/aarch64-linux-gnu/libmali-valhall-g610-g13p0-gbm.so"

# RKNPU2 runtime
RKNPU2_URL="https://github.com/rockchip-linux/rknpu2/archive/refs/heads/master.tar.gz"

# ── node registration agent ─────────────────────────────────────────────────
# Pre-built agent directory (must contain dist/ and node_modules/)
NODE_AGENT_SRC="${NODE_AGENT_SRC:-/home/matt/GitHub/cpedge/node_registration/packages/agent}"
